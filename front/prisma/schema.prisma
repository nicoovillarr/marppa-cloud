generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id          String   @id @default(dbgenerated())
  name        String
  alias       String?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  parentCompanyId String?
  parentCompany   Company? @relation("CompanyHierarchy", fields: [parentCompanyId], references: [id])

  users    User[]
  workers  Worker[]
  zones    Zone[]
  bits     Bit[]
  children Company[] @relation("CompanyHierarchy")
}

model User {
  id        String   @id @default(dbgenerated())
  email     String   @unique
  password  String
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  companyId String?
  company   Company? @relation(fields: [companyId], references: [id])

  sessions Session[]
}

model Worker {
  id       String @id @default(dbgenerated())
  name     String
  cpuCores Int
  ramMB    Int
  diskGB   Int
  status   String

  createdAt DateTime @default(now())
  createdBy String

  updatedAt DateTime @updatedAt
  updatedBy String

  ownerId String
  owner   Company @relation(fields: [ownerId], references: [id])

  fiberId String?
  fiber   Fiber?  @relation(fields: [fiberId], references: [id])
}

model Bit {
  id     String @id @default(dbgenerated())
  name   String
  image  String
  status String

  createdAt DateTime @default(now())
  createdBy String

  updatedAt DateTime @updatedAt
  updatedBy String

  ownerId String
  owner   Company @relation(fields: [ownerId], references: [id])

  fiberId String?
  fiber   Fiber?  @relation(fields: [fiberId], references: [id])
}

model Zone {
  id          String  @id @default(dbgenerated())
  name        String
  description String?
  status      String

  createdAt DateTime @default(now())
  createdBy String

  updatedAt DateTime @updatedAt
  updatedBy String

  ownerId String
  owner   Company @relation(fields: [ownerId], references: [id])

  nodes Node[]
}

model Node {
  id        String @id @default(dbgenerated())
  name      String
  ipAddress String
  status    String

  createdAt DateTime @default(now())
  createdBy String

  updatedAt DateTime @updatedAt
  updatedBy String

  zoneId String
  zone   Zone   @relation(fields: [zoneId], references: [id])

  fibers Fiber[]
}

model Fiber {
  id String @id @default(dbgenerated())

  nodeId String
  node   Node   @relation(fields: [nodeId], references: [id])

  workers Worker[]
  bits    Bit[]
}

model Session {
  token     String   @id
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])
}
